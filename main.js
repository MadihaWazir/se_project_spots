!function(){"use strict";const e=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},t=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(e)?r(t,o):(t.classList.remove(o.inactiveButtonClass),t.disabled=!1)},r=(e,t)=>{e&&(e.classList.add(t.inactiveButtonClass),e.disabled=!0)},o=(t,r,o)=>{r.forEach((r=>{e(t,r,o)}))};function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Saving...",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Save";t?(e.textContent=r,e.setAttribute("disabled",!0)):(e.textContent=o,e.removeAttribute("disabled"))}const a=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>{if(e.ok)return e.json()}))}addCard(e){let{name:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editAvatarInfo(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}changeLikeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"129987cd-1845-4988-87da-5f7e36feb45e","Content-Type":"application/json"}});a.getAppInfo().then((e=>{let[t,r]=e;t.forEach((e=>{const t=B(e);D.append(t)})),document.querySelector(".profile__avatar")})).catch((e=>{console.error(e)}));const s=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),i=document.querySelector(".profile__avatar-button"),c=document.querySelector(".profile__name"),d=document.querySelector(".profile__description"),u=document.querySelector("#edit-modal"),m=u.querySelector(".modal__form"),_=u.querySelector(".modal__close-button"),v=u.querySelector("#profile-name-input"),h=u.querySelector("#profile-description-input"),f=document.querySelector("#add-card-modal"),S=f.querySelector(".modal__form"),y=(f.querySelector(".modal__submit-button"),f.querySelector(".modal__close-button")),b=f.querySelector("#add-card-name-input"),p=f.querySelector("#add-card-link-input"),q=document.querySelector("#avatar-modal"),E=q.querySelector(".modal__form"),k=q.querySelector(".modal__submit-button"),L=q.querySelector(".modal__close-button"),C=(q.querySelector("#avatar-input"),q.querySelector("#profile-avatar-input")),g=document.querySelector("#delete-modal"),$=g.querySelector(".modal__form"),U=g.querySelector(".modal__close-button");U.addEventListener("click",(()=>{O(g)}));const j=g.querySelector(".modal__submit-button");j.addEventListener("click",(()=>{O(g)}));const A=document.querySelector("#preview-modal"),P=A.querySelector(".modal__image"),x=A.querySelector(".modal__caption");A.querySelector(".modal__close-button").addEventListener("click",(()=>{O(A)}));const I=document.querySelector("#card-template"),D=document.querySelector(".cards__list");let T,w;function B(e){const t=I.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-button"),s=t.querySelector(".card__delete-button");return r.textContent=e.name,o.src=e.link,o.alt=e.name,n.addEventListener("click",(t=>function(e,t){const r=e.target.classList.contains("card__like-button_liked");a.changeLikeStatus(t,r).then((t=>{e.target.classList.toggle("card__like-button_liked")})).catch(console.error)}(t,e._id))),e.isLiked&&n.classList.add("card__like-button_liked"),s.addEventListener("click",(r=>function(e,t){T=e,w=t,N(g)}(t,e._id))),o.addEventListener("click",(()=>{N(A),P.src=e.link,P.alt=e.name,x.textContent=e.name})),t}function N(e){e.classList.add("modal_opened"),document.addEventListener("keydown",J)}function O(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",J)}function J(e){"Escape"===e.key&&O(document.querySelector(".modal_opened"))}function H(e){e.target.classList.contains("modal")&&O(e.target)}var z;U.addEventListener("click",(()=>{O(g)})),j.addEventListener("click",(()=>{O(g)})),s.addEventListener("click",(()=>{v.value=c.textContent,h.value=d.textContent,o(m,[v,h],{inputErrorClass:"modal__input_type_error",errorClass:"modal__error"}),N(u)})),_.addEventListener("click",(()=>{O(u)})),l.addEventListener("click",(()=>{N(f)})),y.addEventListener("click",(()=>{O(f)})),m.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;n(t,!0,"Saving...","Save"),a.editUserInfo({name:v.value,about:h.value}).then((e=>{c.textContent=v.value,d.textContent=h.value,O(u)})).catch(console.error).finally((()=>{n(t,!1,"Saving...","Save")}))})),S.addEventListener("submit",(function(e){e.preventDefault(),n(e.submitter,!0,"Saving...","Save");const t={name:b.value,link:p.value};a.addCard(t).then((r=>{const o=B(t);D.prepend(o),e.target.reset(),O(f)})).catch(console.error)})),i.addEventListener("click",(()=>{C.value="",o(E,[C],{inputErrorClass:"modal__input_type_error",errorClass:"modal__error"}),N(q)})),L.addEventListener("click",(()=>{O(q)})),E.addEventListener("submit",(function(e){e.preventDefault(),n(e.submitter,!0,"Saving...","Save"),k.disabled=!0,a.editAvatarInfo(C.value).then((e=>{profileAvatar.src=e.avatar,O(q)})).catch(console.error).finally((()=>{setTimeout((()=>{k.disabled=!1}),1e3)}))})),$.addEventListener("submit",(function(e){e.preventDefault(),n(e.submitter,!0,"Deleting...","Delete"),a.deleteCard(w).then((()=>{T.remove(),O(g)})).catch(console.error)})),document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("mousedown",H)})),z={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},document.querySelectorAll(z.formSelector).forEach((r=>{((r,o)=>{const n=Array.from(r.querySelectorAll(o.inputSelector)),a=r.querySelector(o.submitButtonSelector);t(n,a,o),n.forEach((s=>{s.addEventListener("input",(function(){((t,r,o)=>{r.validity.valid?e(t,r,o):((e,t,r,o)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(o.inputErrorClass)})(t,r,r.validationMessage,o)})(r,s,o),t(n,a,o)}))}))})(r,z)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNibUcsRUFBV0osRUFBWSxJQUV4QnhCLE1BQU1FLFFBQVFDLE1BQ25CLElBaUZlSixTQUFTdUUsaUJBQWlCLFVBUWxDOUgsU0FBUzhHLElBQ2RBLEVBQU0zQixpQkFBaUIsWUFBYStCLEVBQWEsSUZyUmxCdEksRUF2RVQsQ0FDdEJtSixhQUFjLGVBQ2RDLGNBQWUsZ0JBQ2ZDLHFCQUFzQix3QkFDdEJySSxvQkFBcUIsZ0NBQ3JCVixnQkFBaUIsMEJBQ2pCa0ksV0FBWSx3QkFrRUs3RCxTQUFTdUUsaUJBQWlCbEosRUFBT21KLGNBQ3pDL0gsU0FBU3RCLElBaEJNd0osRUFBQ3hKLEVBQVFFLEtBQ2pDLE1BQU1RLEVBQVkrSSxNQUFNQyxLQUFLMUosRUFBT29KLGlCQUFpQmxKLEVBQU9vSixnQkFDdERLLEVBQWdCM0osRUFBT0csY0FBY0QsRUFBT3FKLHNCQUVsRDlJLEVBQWtCQyxFQUFXaUosRUFBZXpKLEdBRTVDUSxFQUFVWSxTQUFTc0ksSUFDakJBLEVBQWFuRCxpQkFBaUIsU0FBUyxXQTNDaEJvRCxFQUFDN0osRUFBUUMsRUFBU0MsS0FDdENELEVBQVFhLFNBQVNDLE1BR3BCaEIsRUFBZUMsRUFBUUMsRUFBU0MsR0FoQmI0SixFQUFDOUosRUFBUUMsRUFBUzhKLEVBQVU3SixLQUM5QkYsRUFBT0csY0FBYyxJQUFJRixFQUFRRyxZQUN6Q0MsWUFBYzBKLEVBQ3pCOUosRUFBUUssVUFBVWMsSUFBSWxCLEVBQU9NLGdCQUFnQixFQVczQ3NKLENBQWU5SixFQUFRQyxFQUFTQSxFQUFRK0osa0JBQW1COUosRUFHN0QsRUF1Q0kySixDQUFtQjdKLEVBQVE0SixFQUFjMUosR0FDekNPLEVBQWtCQyxFQUFXaUosRUFBZXpKLEVBQzlDLEdBQUUsR0FDRixFQU1Bc0osQ0FBa0J4SixFQUFRRSxFQUFPLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idXR0b25fZGlzYWJsZWRcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcclxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXHJcbn07XHJcblxyXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWwsIGlucHV0RWwsIGVycm9yTXNnLCBjb25maWcpID0+IHtcclxuICBjb25zdCBlcnJvck1zZ0VsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XHJcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IGVycm9yTXNnO1xyXG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxufTtcclxuXHJcbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XHJcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xyXG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxufTtcclxuXHJcbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykgPT4ge1xyXG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXQpID0+IHtcclxuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpID0+IHtcclxuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcclxuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWwsIGNvbmZpZyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGJ1dHRvbkVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsLCBjb25maWcpID0+IHtcclxuICBpZiAoYnV0dG9uRWwpIHtcclxuICAgIGJ1dHRvbkVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSB0cnVlO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsLCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xyXG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKTtcclxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWwpID0+IHtcclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbCwgY29uZmlnKTtcclxuICB9KTtcclxufTtcclxuIiwiZXhwb3J0IGZ1bmN0aW9uIHNldEJ1dHRvblRleHQoXHJcbiAgc3VibWl0QnV0dG9uLFxyXG4gIGlzTG9hZGluZyxcclxuICBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCIsXHJcbiAgZGVmYXVsdFRleHQgPSBcIlNhdmVcIlxyXG4pIHtcclxuICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICBzdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcclxuICAgIHN1Ym1pdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcclxuICB9IGVsc2Uge1xyXG4gICAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gZGVmYXVsdFRleHQ7XHJcbiAgICBzdWJtaXRCdXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcblxyXG5pbXBvcnQge1xyXG4gIGVuYWJsZVZhbGlkYXRpb24sXHJcbiAgc2V0dGluZ3MsXHJcbiAgcmVzZXRWYWxpZGF0aW9uLFxyXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcclxuXHJcbmltcG9ydCBsb2dvIGZyb20gXCIuLi9pbWFnZXMvbG9nby5zdmdcIjtcclxuaW1wb3J0IGF2YXRhciBmcm9tIFwiLi4vaW1hZ2VzL2F2YXRhci5qcGdcIjtcclxuaW1wb3J0IHByb2ZpbGVJbWFnZSBmcm9tIFwiLi4vaW1hZ2VzL3BlbmNpbC1saWdodC5zdmdcIjtcclxuaW1wb3J0IHBsdXNJbWFnZSBmcm9tIFwiLi4vaW1hZ2VzL3BsdXMuc3ZnXCI7XHJcblxyXG5pbXBvcnQgeyBzZXRCdXR0b25UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcclxuXHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xyXG5cclxuY29uc3QgaW5pdGlhbENhcmRzID0gW1xyXG4gIHtcclxuICAgIG5hbWU6IFwiVmFsIFRob3JlbnNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiUmVzdGF1cmVudCB0ZXJyYWNlXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMi1waG90by1ieS1jZWlsaW5lLWZyb20tcGV4ZWxzLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJBbiBvdXRkb29yIGNhZmVcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8zLXBob3RvLWJ5LXR1YmFudXItZG9nYW4tZnJvbS1wZXhlbHMuanBnXCIsXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkEgdmVyeSBsb25nIGJyaWRnZSwgb3ZlciB0aGUgZm9yZXN0IGFuZCB0aHJvdWdoIHRoZSB0cmVlc1wiLFxyXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzQtcGhvdG8tYnktbWF1cmljZS1sYXNjaGV0LWZyb20tcGV4ZWxzLmpwZ1wiLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJUdW5uZWwgd2l0aCBtb3JuaW5nIGxpZ2h0XCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNS1waG90by1ieS12YW4tYW5oLW5ndXllbi1mcm9tLXBleGVscy5qcGdcIixcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiTW91bnRhaW4gaG91c2VcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy82LXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcclxuICB9LFxyXG5dO1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiMTI5OTg3Y2QtMTg0NS00OTg4LTg3ZGEtNWY3ZTM2ZmViNDVlXCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59KTtcclxuXHJcbmFwaVxyXG4gIC5nZXRBcHBJbmZvKClcclxuICAudGhlbigoW2NhcmRzLCB1c2VyXSkgPT4ge1xyXG4gICAgY2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGl0ZW0pO1xyXG4gICAgICBjYXJkc0xpc3QuYXBwZW5kKGNhcmRFbGVtZW50KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHByb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXRVc2VyRGF0YShkYXRhKSB7XHJcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xyXG4gICAgICBwcm9maWxlQXZhdGFyLnNyYyA9IGRhdGEuYXZhdGFyO1xyXG4gICAgfVxyXG4gIH0pXHJcbiAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICB9KTtcclxuXHJcbi8vIFByb2ZpbGUgZWxlbWVudHNcclxuY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xyXG5jb25zdCBjYXJkTW9kYWxCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIik7XHJcbmNvbnN0IGF2YXRhck1vZGFsQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnV0dG9uXCIpO1xyXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcclxuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcclxuXHJcbi8vIEVkaXQgZm9ybSBlbGVtZW50c1xyXG5jb25zdCBlZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtbW9kYWxcIik7XHJcbmNvbnN0IGVkaXRGb3JtRWxlbWVudCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBlZGl0TW9kYWxDbG9zZUJ1dHRvbiA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIik7XHJcbmNvbnN0IGVkaXRNb2RhbE5hbWVJbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcclxuY29uc3QgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxyXG4pO1xyXG5cclxuLy8gQ2FyZCBmb3JtIGVsZW1lbnRzXHJcbmNvbnN0IGNhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbW9kYWxcIik7XHJcbmNvbnN0IGNhcmRGb3JtID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcbmNvbnN0IGNhcmRTdWJtaXRCdXR0b24gPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiKTtcclxuY29uc3QgY2FyZE1vZGFsQ2xvc2VCdXR0b24gPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCIpO1xyXG5jb25zdCBjYXJkTmFtZUlucHV0ID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbmFtZS1pbnB1dFwiKTtcclxuY29uc3QgY2FyZExpbmtJbnB1dCA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLWxpbmstaW5wdXRcIik7XHJcblxyXG4vLyBBdmF0YXIgZm9ybSBlbGVtZW50c1xyXG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xyXG5jb25zdCBhdmF0YXJGb3JtID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuY29uc3QgYXZhdGFyU3VibWl0QnV0dG9uID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiKTtcclxuY29uc3QgYXZhdGFyTW9kYWxDbG9zZUJ1dHRvbiA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiXHJcbik7XHJcbmNvbnN0IGF2YXRhcmlucHV0ID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItaW5wdXRcIik7XHJcbmNvbnN0IGF2YXRhckxpbmtJbnB1dCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hdmF0YXItaW5wdXRcIik7XHJcblxyXG4vLyBEZWxldGUgZm9ybSBlbGVtZW50c1xyXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xyXG5jb25zdCBkZWxldGVGb3JtID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuXHJcbmNvbnN0IGRlbGV0ZU1vZGFsQ2xvc2VCdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiLm1vZGFsX19jbG9zZS1idXR0b25cIlxyXG4pO1xyXG5cclxuZGVsZXRlTW9kYWxDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG59KTtcclxuXHJcbmNvbnN0IGRlbGV0ZU1vZGFsQ2FuY2VsQnV0dG9uID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcclxuICBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiXHJcbik7XHJcblxyXG5kZWxldGVNb2RhbENhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG59KTtcclxuXHJcbi8vIFByZXZpZXcgaW1hZ2UgcG9wdXAgZWxlbWVudHNcclxuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xyXG5jb25zdCBwcmV2aWV3TW9kYWxJbWFnZUVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG5jb25zdCBwcmV2aWV3TW9kYWxDYXB0aW9uRWwgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcclxuY29uc3QgcHJldmlld01vZGFsQ2xvc2VCdXR0b24gPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcclxuICBcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCJcclxuKTtcclxucHJldmlld01vZGFsQ2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XHJcbn0pO1xyXG5cclxuLy8gQ2FyZCByZWxhdGVkIGVsZW1lbnRzXHJcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcclxuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcclxuXHJcbmxldCBzZWxlY3RlZENhcmQ7XHJcbmxldCBzZWxlY3RlZENhcmRJZDtcclxuXHJcbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jb250ZW50XHJcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG5cclxuICBjb25zdCBjYXJkTmFtZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcclxuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcbiAgY29uc3QgY2FyZExpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xyXG4gIGNvbnN0IGNhcmREZWxldGVCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XHJcblxyXG4gIGNhcmROYW1lRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xyXG4gIGNhcmRJbWFnZUVsLmFsdCA9IGRhdGEubmFtZTtcclxuXHJcbiAgY2FyZExpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IGhhbmRsZUxpa2UoZXZ0LCBkYXRhLl9pZCkpO1xyXG5cclxuICBpZiAoZGF0YS5pc0xpa2VkKSB7XHJcbiAgICBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIik7XHJcbiAgfVxyXG5cclxuICBjYXJkRGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PlxyXG4gICAgaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YS5faWQpXHJcbiAgKTtcclxuXHJcbiAgY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xyXG4gICAgcHJldmlld01vZGFsSW1hZ2VFbC5zcmMgPSBkYXRhLmxpbms7XHJcbiAgICBwcmV2aWV3TW9kYWxJbWFnZUVsLmFsdCA9IGRhdGEubmFtZTtcclxuICAgIHByZXZpZXdNb2RhbENhcHRpb25FbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG59XHJcblxyXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcclxuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlTW9kYWxFc2MpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XHJcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcclxuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjbG9zZU1vZGFsRXNjKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ1dHRvbiwgdHJ1ZSwgXCJTYXZpbmcuLi5cIiwgXCJTYXZlXCIpO1xyXG5cclxuICBhcGlcclxuICAgIC5lZGl0VXNlckluZm8oe1xyXG4gICAgICBuYW1lOiBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUsXHJcbiAgICAgIGFib3V0OiBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxyXG4gICAgfSlcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gZWRpdE1vZGFsTmFtZUlucHV0LnZhbHVlO1xyXG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0LnZhbHVlO1xyXG4gICAgICBjbG9zZU1vZGFsKGVkaXRNb2RhbCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCBmYWxzZSwgXCJTYXZpbmcuLi5cIiwgXCJTYXZlXCIpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUFkZENhcmRTdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSwgXCJTYXZpbmcuLi5cIiwgXCJTYXZlXCIpO1xyXG4gIGNvbnN0IGlucHV0VmFsdWVzID0geyBuYW1lOiBjYXJkTmFtZUlucHV0LnZhbHVlLCBsaW5rOiBjYXJkTGlua0lucHV0LnZhbHVlIH07XHJcbiAgYXBpXHJcbiAgICAuYWRkQ2FyZChpbnB1dFZhbHVlcylcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNhcmRFbCA9IGdldENhcmRFbGVtZW50KGlucHV0VmFsdWVzKTtcclxuICAgICAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsKTtcclxuXHJcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcclxuICAgICAgY2xvc2VNb2RhbChjYXJkTW9kYWwpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBldnQuc3VibWl0dGVyO1xyXG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCB0cnVlLCBcIlNhdmluZy4uLlwiLCBcIlNhdmVcIik7XHJcbiAgYXZhdGFyU3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuXHJcbiAgYXBpXHJcbiAgICAuZWRpdEF2YXRhckluZm8oYXZhdGFyTGlua0lucHV0LnZhbHVlKVxyXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgcHJvZmlsZUF2YXRhci5zcmMgPSBkYXRhLmF2YXRhcjtcclxuICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGF2YXRhclN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICB9LCAxMDAwKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSwgXCJEZWxldGluZy4uLlwiLCBcIkRlbGV0ZVwiKTtcclxuICBhcGlcclxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxyXG4gICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XHJcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgY2FyZElkKSB7XHJcbiAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XHJcbiAgc2VsZWN0ZWRDYXJkSWQgPSBjYXJkSWQ7XHJcbiAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlTGlrZShldnQsIGlkKSB7XHJcbiAgY29uc3QgaXNMaWtlZCA9IGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIik7XHJcbiAgYXBpXHJcbiAgICAuY2hhbmdlTGlrZVN0YXR1cyhpZCwgaXNMaWtlZClcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcclxufVxyXG5cclxuZGVsZXRlTW9kYWxDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG59KTtcclxuXHJcbmRlbGV0ZU1vZGFsQ2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcclxuICBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50O1xyXG4gIHJlc2V0VmFsaWRhdGlvbihcclxuICAgIGVkaXRGb3JtRWxlbWVudCxcclxuICAgIFtlZGl0TW9kYWxOYW1lSW5wdXQsIGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXRdLFxyXG4gICAge1xyXG4gICAgICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcclxuICAgICAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JcIixcclxuICAgIH1cclxuICApO1xyXG4gIG9wZW5Nb2RhbChlZGl0TW9kYWwpO1xyXG59KTtcclxuXHJcbmVkaXRNb2RhbENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChlZGl0TW9kYWwpO1xyXG59KTtcclxuXHJcbmNhcmRNb2RhbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIG9wZW5Nb2RhbChjYXJkTW9kYWwpO1xyXG59KTtcclxuXHJcbmNhcmRNb2RhbENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChjYXJkTW9kYWwpO1xyXG59KTtcclxuXHJcbmVkaXRGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRGb3JtU3VibWl0KTtcclxuXHJcbmNhcmRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQWRkQ2FyZFN1Ym1pdCk7XHJcblxyXG5mdW5jdGlvbiBjbG9zZU1vZGFsRXNjKGV2dCkge1xyXG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICBjb25zdCBtb2RhbE9wZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKTtcclxuICAgIGNsb3NlTW9kYWwobW9kYWxPcGVuKTtcclxuICB9XHJcbn1cclxuXHJcbmF2YXRhck1vZGFsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgYXZhdGFyTGlua0lucHV0LnZhbHVlID0gXCJcIjtcclxuICByZXNldFZhbGlkYXRpb24oYXZhdGFyRm9ybSwgW2F2YXRhckxpbmtJbnB1dF0sIHtcclxuICAgIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxyXG4gICAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JcIixcclxuICB9KTtcclxuXHJcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcclxufSk7XHJcblxyXG5hdmF0YXJNb2RhbENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XHJcbn0pO1xyXG5cclxuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XHJcblxyXG5kZWxldGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRGVsZXRlU3VibWl0KTtcclxuXHJcbmNvbnN0IG1vZGFscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XHJcblxyXG5mdW5jdGlvbiBjbG9zZU92ZXJsYXkoZXZ0KSB7XHJcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcclxuICAgIGNsb3NlTW9kYWwoZXZ0LnRhcmdldCk7XHJcbiAgfVxyXG59XHJcblxyXG5tb2RhbHMuZm9yRWFjaCgobW9kYWwpID0+IHtcclxuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGNsb3NlT3ZlcmxheSk7XHJcbn0pO1xyXG5cclxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XHJcbiIsImNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldEFwcEluZm8oKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9XHJcblxyXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgbGluayxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBhYm91dCxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlZGl0QXZhdGFySW5mbyhhdmF0YXIpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgYXZhdGFyLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUNhcmQoaWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2hhbmdlTGlrZVN0YXR1cyhpZCwgaXNMaWtlZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEFwaTtcclxuIl0sIm5hbWVzIjpbImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiaW5wdXRFcnJvckNsYXNzIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbCIsInNvbWUiLCJpbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImRpc2FibGVkIiwiYWRkIiwicmVzZXRWYWxpZGF0aW9uIiwiZm9yRWFjaCIsInNldEJ1dHRvblRleHQiLCJzdWJtaXRCdXR0b24iLCJpc0xvYWRpbmciLCJsb2FkaW5nVGV4dCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImRlZmF1bHRUZXh0Iiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwiYXBpIiwiY29uc3RydWN0b3IiLCJfcmVmIiwiYmFzZVVybCIsImhlYWRlcnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEFwcEluZm8iLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJhZGRDYXJkIiwiX3JlZjIiLCJuYW1lIiwibGluayIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdFVzZXJJbmZvIiwiX3JlZjMiLCJhYm91dCIsImVkaXRBdmF0YXJJbmZvIiwiYXZhdGFyIiwiZGVsZXRlQ2FyZCIsImNoYW5nZUxpa2VTdGF0dXMiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzIiwidXNlciIsIml0ZW0iLCJjYXJkRWxlbWVudCIsImdldENhcmRFbGVtZW50IiwiY2FyZHNMaXN0IiwiYXBwZW5kIiwiZG9jdW1lbnQiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsInByb2ZpbGVFZGl0QnV0dG9uIiwiY2FyZE1vZGFsQnV0dG9uIiwiYXZhdGFyTW9kYWxCdXR0b24iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsImVkaXRNb2RhbCIsImVkaXRGb3JtRWxlbWVudCIsImVkaXRNb2RhbENsb3NlQnV0dG9uIiwiZWRpdE1vZGFsTmFtZUlucHV0IiwiZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dCIsImNhcmRNb2RhbCIsImNhcmRGb3JtIiwiY2FyZE1vZGFsQ2xvc2VCdXR0b24iLCJjYXJkTmFtZUlucHV0IiwiY2FyZExpbmtJbnB1dCIsImF2YXRhck1vZGFsIiwiYXZhdGFyRm9ybSIsImF2YXRhclN1Ym1pdEJ1dHRvbiIsImF2YXRhck1vZGFsQ2xvc2VCdXR0b24iLCJhdmF0YXJMaW5rSW5wdXQiLCJkZWxldGVNb2RhbCIsImRlbGV0ZUZvcm0iLCJkZWxldGVNb2RhbENsb3NlQnV0dG9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNsb3NlTW9kYWwiLCJkZWxldGVNb2RhbENhbmNlbEJ1dHRvbiIsInByZXZpZXdNb2RhbCIsInByZXZpZXdNb2RhbEltYWdlRWwiLCJwcmV2aWV3TW9kYWxDYXB0aW9uRWwiLCJjYXJkVGVtcGxhdGUiLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImRhdGEiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZE5hbWVFbCIsImNhcmRJbWFnZUVsIiwiY2FyZExpa2VCdXR0b24iLCJjYXJkRGVsZXRlQnV0dG9uIiwic3JjIiwiYWx0IiwiZXZ0IiwidGFyZ2V0IiwiY29udGFpbnMiLCJ0b2dnbGUiLCJoYW5kbGVMaWtlIiwiX2lkIiwiY2FyZElkIiwib3Blbk1vZGFsIiwiaGFuZGxlRGVsZXRlQ2FyZCIsIm1vZGFsIiwiY2xvc2VNb2RhbEVzYyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJjbG9zZU92ZXJsYXkiLCJ2YWx1ZSIsImVycm9yQ2xhc3MiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdHRlciIsImZpbmFsbHkiLCJpbnB1dFZhbHVlcyIsImNhcmRFbCIsInByZXBlbmQiLCJyZXNldCIsInByb2ZpbGVBdmF0YXIiLCJzZXRUaW1lb3V0IiwicXVlcnlTZWxlY3RvckFsbCIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIiwiYnV0dG9uRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNc2ciLCJ2YWxpZGF0aW9uTWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=